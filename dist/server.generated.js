/*! For license information please see server.generated.js.LICENSE.txt */
(()=>{"use strict";var e={n:r=>{var t=r&&r.__esModule?()=>r.default:()=>r;return e.d(t,{a:t}),t},d:(r,t)=>{for(var n in t)e.o(t,n)&&!e.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:t[n]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)};const r=require("express");var t=e.n(r);const n=require("path");var o=e.n(n);const a=require("cookie-parser");var u=e.n(a);const i=require("compression");var s=e.n(i);const c=require("cors");var f=e.n(c);const p=require("helmet");var l=e.n(p);const d=require("mongoose");var v=e.n(d);const y={env:"production",port:process.env.PORT||3e3,jwtSecret:process.env.JWT_SECRET||"YOUR_secret_key",mongoUri:process.env.MONGODB_URI||process.env.MONGO_HOST||"mongodb://127.0.0.1:27017/mern-expense-tracker"},h=require("crypto");var m=e.n(h),b=new(v().Schema)({name:{type:String,trim:!0,required:"Name is required"},email:{type:String,trim:!0,unique:"Email already exists",match:[/.+\@.+\..+/,"Please fill a valid email address"],required:"Email is required"},hashed_password:{type:String,required:"Password is required"},salt:String,created:{type:Date,default:Date.now},updated:Date},{timestamps:!0});b.virtual("password").set(function(e){this._password=e,this.salt=this.makeSalt(),this.hashed_password=this.encryptPassword(e)}).get(function(){return this._password}),b.methods={authenticate:function(e){return this.encryptPassword(e)===this.hashed_password},encryptPassword:function(e){if(!e)return"";try{return m().createHmac("sha256",this.salt).update(e).digest("hex")}catch(e){return""}},makeSalt:function(){return Math.round((new Date).valueOf()*Math.random())+""}};const w=v().model("User",b),g=require("lodash/extend.js");var j=e.n(g);function O(){var e,r,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function a(t,n,o,a){var s=n&&n.prototype instanceof i?n:i,c=Object.create(s.prototype);return S(c,"_invoke",function(t,n,o){var a,i,s,c=0,f=o||[],p=!1,l={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(r,t){return a=r,i=0,s=e,l.n=t,u}};function d(t,n){for(i=t,s=n,r=0;!p&&c&&!o&&r<f.length;r++){var o,a=f[r],d=l.p,v=a[2];t>3?(o=v===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=d&&((o=t<2&&d<a[1])?(i=0,l.v=n,l.n=a[1]):d<v&&(o=t<3||a[0]>n||n>v)&&(a[4]=t,a[5]=n,l.n=v,i=0))}if(o||t>1)return u;throw p=!0,n}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(p&&1===f&&d(f,v),i=f,s=v;(r=i<2?e:s)||!p;){a||(i?i<3?(i>1&&(l.n=-1),d(i,s)):l.n=s:l.v=s);try{if(c=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(p=l.n<0)?s:t.call(n,l))!==u)break}catch(r){a=e,i=1,s=r}finally{c=1}}return{value:r,done:p}}}(t,o,a),!0),c}var u={};function i(){}function s(){}function c(){}r=Object.getPrototypeOf;var f=[][n]?r(r([][n]())):(S(r={},n,function(){return this}),r),p=c.prototype=i.prototype=Object.create(f);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,S(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return s.prototype=c,S(p,"constructor",c),S(c,"constructor",s),s.displayName="GeneratorFunction",S(c,o,"GeneratorFunction"),S(p),S(p,o,"Generator"),S(p,n,function(){return this}),S(p,"toString",function(){return"[object Generator]"}),(O=function(){return{w:a,m:l}})()}function S(e,r,t,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}S=function(e,r,t,n){if(r)o?o(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t;else{var a=function(r,t){S(e,r,function(e){return this._invoke(r,t,e)})};a("next",0),a("throw",1),a("return",2)}},S(e,r,t,n)}function P(e,r,t,n,o,a,u){try{var i=e[a](u),s=i.value}catch(e){return void t(e)}i.done?r(s):Promise.resolve(s).then(n,o)}function _(e){return function(){var r=this,t=arguments;return new Promise(function(n,o){var a=e.apply(r,t);function u(e){P(a,n,o,u,i,"next",e)}function i(e){P(a,n,o,u,i,"throw",e)}u(void 0)})}}const k={create:function(){var e=_(O().m(function e(r,t){var n,o;return O().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,n=new w(r.body),e.n=1,n.save();case 1:return e.a(2,t.status(200).json({message:"Successfully signed up!"}));case 2:return e.p=2,o=e.v,e.a(2,t.status(400).json({error:"Signup failed: "+o.message}))}},e,null,[[0,2]])}));return function(r,t){return e.apply(this,arguments)}}(),list:function(){var e=_(O().m(function e(r,t){var n;return O().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,w.find().select("name email updated created");case 1:n=e.v,t.json(n),e.n=3;break;case 2:return e.p=2,e.v,e.a(2,t.status(400).json({error:"Failed to list users"}));case 3:return e.a(2)}},e,null,[[0,2]])}));return function(r,t){return e.apply(this,arguments)}}(),userByID:function(){var e=_(O().m(function e(r,t,n,o){var a;return O().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,w.findById(o);case 1:if(a=e.v){e.n=2;break}return e.a(2,t.status(400).json({error:"User not found"}));case 2:r.profile=a,n(),e.n=4;break;case 3:return e.p=3,e.v,e.a(2,t.status(400).json({error:"Could not retrieve user"}));case 4:return e.a(2)}},e,null,[[0,3]])}));return function(r,t,n,o){return e.apply(this,arguments)}}(),read:function(e,r){return e.profile.hashed_password=void 0,e.profile.salt=void 0,r.json(e.profile)},update:function(){var e=_(O().m(function e(r,t){var n;return O().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,n=r.profile,(n=j()(n,r.body)).updated=Date.now(),e.n=1,n.save();case 1:n.hashed_password=void 0,n.salt=void 0,t.json(n),e.n=3;break;case 2:return e.p=2,e.v,e.a(2,t.status(400).json({error:"User update failed"}));case 3:return e.a(2)}},e,null,[[0,2]])}));return function(r,t){return e.apply(this,arguments)}}(),remove:function(){var e=_(O().m(function e(r,t){var n,o;return O().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,n=r.profile,e.n=1,n.deleteOne();case 1:(o=e.v).hashed_password=void 0,o.salt=void 0,t.json(o),e.n=3;break;case 2:return e.p=2,e.v,e.a(2,t.status(400).json({error:"Failed to delete user"}));case 3:return e.a(2)}},e,null,[[0,2]])}));return function(r,t){return e.apply(this,arguments)}}()};var q=t().Router();q.route("/api/users").get(k.list).post(k.create),q.route("/api/users/:userId").get(k.read).put(k.update).delete(k.remove),q.param("userId",k.userByID);const x=q,T=require("jsonwebtoken");var D=e.n(T);function E(){var e,r,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function a(t,n,o,a){var s=n&&n.prototype instanceof i?n:i,c=Object.create(s.prototype);return G(c,"_invoke",function(t,n,o){var a,i,s,c=0,f=o||[],p=!1,l={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(r,t){return a=r,i=0,s=e,l.n=t,u}};function d(t,n){for(i=t,s=n,r=0;!p&&c&&!o&&r<f.length;r++){var o,a=f[r],d=l.p,v=a[2];t>3?(o=v===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=d&&((o=t<2&&d<a[1])?(i=0,l.v=n,l.n=a[1]):d<v&&(o=t<3||a[0]>n||n>v)&&(a[4]=t,a[5]=n,l.n=v,i=0))}if(o||t>1)return u;throw p=!0,n}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(p&&1===f&&d(f,v),i=f,s=v;(r=i<2?e:s)||!p;){a||(i?i<3?(i>1&&(l.n=-1),d(i,s)):l.n=s:l.v=s);try{if(c=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(p=l.n<0)?s:t.call(n,l))!==u)break}catch(r){a=e,i=1,s=r}finally{c=1}}return{value:r,done:p}}}(t,o,a),!0),c}var u={};function i(){}function s(){}function c(){}r=Object.getPrototypeOf;var f=[][n]?r(r([][n]())):(G(r={},n,function(){return this}),r),p=c.prototype=i.prototype=Object.create(f);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,G(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return s.prototype=c,G(p,"constructor",c),G(c,"constructor",s),s.displayName="GeneratorFunction",G(c,o,"GeneratorFunction"),G(p),G(p,o,"Generator"),G(p,n,function(){return this}),G(p,"toString",function(){return"[object Generator]"}),(E=function(){return{w:a,m:l}})()}function G(e,r,t,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}G=function(e,r,t,n){if(r)o?o(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t;else{var a=function(r,t){G(e,r,function(e){return this._invoke(r,t,e)})};a("next",0),a("throw",1),a("return",2)}},G(e,r,t,n)}function I(e,r,t,n,o,a,u){try{var i=e[a](u),s=i.value}catch(e){return void t(e)}i.done?r(s):Promise.resolve(s).then(n,o)}function U(e){return function(){var r=this,t=arguments;return new Promise(function(n,o){var a=e.apply(r,t);function u(e){I(a,n,o,u,i,"next",e)}function i(e){I(a,n,o,u,i,"throw",e)}u(void 0)})}}const F={signin:function(){var e=U(E().m(function e(r,t){var n,o,a,u,i;return E().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,n=r.body,o=n.email,a=n.password,e.n=1,w.findOne({email:o});case 1:if(u=e.v){e.n=2;break}return e.a(2,t.status(401).json({error:"User not found"}));case 2:if(u.authenticate(a)){e.n=3;break}return e.a(2,t.status(401).json({error:"Email and password do not match"}));case 3:return i=D().sign({_id:u._id},y.jwtSecret,{expiresIn:"7d"}),t.cookie("t",i,{expire:new Date+9999}),e.a(2,t.json({token:i,user:{_id:u._id,name:u.name,email:u.email}}));case 4:return e.p=4,e.v,e.a(2,t.status(401).json({error:"Could not sign in"}))}},e,null,[[0,4]])}));return function(r,t){return e.apply(this,arguments)}}(),signout:function(e,r){return r.clearCookie("t"),r.status(200).json({message:"Signed out"})},requireSignin:function(){var e=U(E().m(function e(r,t,n){var o,a,u;return E().w(function(e){for(;;)switch(e.n){case 0:if(a=null===(o=r.headers.authorization)||void 0===o?void 0:o.split(" ")[1]){e.n=1;break}return e.a(2,t.status(401).json({error:"Unauthorized"}));case 1:e.p=1,u=D().verify(a,y.jwtSecret),r.auth=u,n(),e.n=3;break;case 2:return e.p=2,e.v,e.a(2,t.status(403).json({error:"Invalid token"}));case 3:return e.a(2)}},e,null,[[1,2]])}));return function(r,t,n){return e.apply(this,arguments)}}()};var M=t().Router();M.route("/auth/signin").post(F.signin),M.route("/auth/signout").get(F.signout);const B=M;var N=new(v().Schema)({title:{type:String,trim:!0,required:"Title is required"},amount:{type:Number,required:"Amount is required"},category:{type:String,trim:!0,required:"Category is required"},incurred_on:{type:Date,default:Date.now},updated:Date,user:{type:v().Schema.ObjectId,ref:"User"}},{timestamps:!0});const R=v().model("Expense",N);function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function $(){var e,r,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function a(t,n,o,a){var s=n&&n.prototype instanceof i?n:i,c=Object.create(s.prototype);return A(c,"_invoke",function(t,n,o){var a,i,s,c=0,f=o||[],p=!1,l={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(r,t){return a=r,i=0,s=e,l.n=t,u}};function d(t,n){for(i=t,s=n,r=0;!p&&c&&!o&&r<f.length;r++){var o,a=f[r],d=l.p,v=a[2];t>3?(o=v===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=d&&((o=t<2&&d<a[1])?(i=0,l.v=n,l.n=a[1]):d<v&&(o=t<3||a[0]>n||n>v)&&(a[4]=t,a[5]=n,l.n=v,i=0))}if(o||t>1)return u;throw p=!0,n}return function(o,f,v){if(c>1)throw TypeError("Generator is already running");for(p&&1===f&&d(f,v),i=f,s=v;(r=i<2?e:s)||!p;){a||(i?i<3?(i>1&&(l.n=-1),d(i,s)):l.n=s:l.v=s);try{if(c=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(p=l.n<0)?s:t.call(n,l))!==u)break}catch(r){a=e,i=1,s=r}finally{c=1}}return{value:r,done:p}}}(t,o,a),!0),c}var u={};function i(){}function s(){}function c(){}r=Object.getPrototypeOf;var f=[][n]?r(r([][n]())):(A(r={},n,function(){return this}),r),p=c.prototype=i.prototype=Object.create(f);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,A(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return s.prototype=c,A(p,"constructor",c),A(c,"constructor",s),s.displayName="GeneratorFunction",A(c,o,"GeneratorFunction"),A(p),A(p,o,"Generator"),A(p,n,function(){return this}),A(p,"toString",function(){return"[object Generator]"}),($=function(){return{w:a,m:l}})()}function A(e,r,t,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}A=function(e,r,t,n){if(r)o?o(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t;else{var a=function(r,t){A(e,r,function(e){return this._invoke(r,t,e)})};a("next",0),a("throw",1),a("return",2)}},A(e,r,t,n)}function H(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function z(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?H(Object(t),!0).forEach(function(r){J(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):H(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function J(e,r,t){return(r=function(e){var r=function(e){if("object"!=C(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,"string");if("object"!=C(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==C(r)?r:r+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function W(e,r,t,n,o,a,u){try{var i=e[a](u),s=i.value}catch(e){return void t(e)}i.done?r(s):Promise.resolve(s).then(n,o)}function Y(e){return function(){var r=this,t=arguments;return new Promise(function(n,o){var a=e.apply(r,t);function u(e){W(a,n,o,u,i,"next",e)}function i(e){W(a,n,o,u,i,"throw",e)}u(void 0)})}}const K={create:function(){var e=Y($().m(function e(r,t){var n;return $().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,n=new R(z(z({},r.body),{},{user:r.auth._id})),e.n=1,n.save();case 1:t.status(200).json({message:"Expense created"}),e.n=3;break;case 2:e.p=2,e.v,t.status(400).json({error:"Could not create expense"});case 3:return e.a(2)}},e,null,[[0,2]])}));return function(r,t){return e.apply(this,arguments)}}(),listByUser:function(){var e=Y($().m(function e(r,t){var n,o,a,u,i;return $().w(function(e){for(;;)switch(e.n){case 0:return n=r.auth._id,o={},r.query.category&&(o.category=r.query.category),r.query.month&&(a=new Date(r.query.month),(u=new Date(a)).setMonth(a.getMonth()+1),o.incurred_on={$gte:a,$lt:u}),e.p=1,e.n=2,R.find(z({user:n},o)).sort({incurred_on:-1});case 2:i=e.v,t.json(i),e.n=4;break;case 3:e.p=3,e.v,t.status(400).json({error:"Could not retrieve expenses"});case 4:return e.a(2)}},e,null,[[1,3]])}));return function(r,t){return e.apply(this,arguments)}}(),read:function(){var e=Y($().m(function e(r,t){var n;return $().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,R.findById(r.params.expenseId);case 1:if(n=e.v){e.n=2;break}return e.a(2,t.status(404).json({error:"Expense not found"}));case 2:t.json(n),e.n=4;break;case 3:e.p=3,e.v,t.status(400).json({error:"Failed to read expense"});case 4:return e.a(2)}},e,null,[[0,3]])}));return function(r,t){return e.apply(this,arguments)}}(),update:function(){var e=Y($().m(function e(r,t){var n;return $().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,R.findByIdAndUpdate(r.params.expenseId,r.body,{new:!0});case 1:n=e.v,t.json(n),e.n=3;break;case 2:e.p=2,e.v,t.status(400).json({error:"Failed to update expense"});case 3:return e.a(2)}},e,null,[[0,2]])}));return function(r,t){return e.apply(this,arguments)}}(),remove:function(){var e=Y($().m(function e(r,t){var n;return $().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,R.findByIdAndDelete(r.params.expenseId);case 1:n=e.v,t.json(n),e.n=3;break;case 2:e.p=2,e.v,t.status(400).json({error:"Failed to delete expense"});case 3:return e.a(2)}},e,null,[[0,2]])}));return function(r,t){return e.apply(this,arguments)}}(),currentMonthPreview:function(){var e=Y($().m(function e(r,t){var n,o,a;return $().w(function(e){for(;;)switch(e.n){case 0:return(n=new Date).setDate(1),(o=new Date(n)).setMonth(n.getMonth()+1),e.p=1,e.n=2,R.find({user:r.auth._id,incurred_on:{$gte:n,$lt:o}});case 2:a=e.v,t.json(a),e.n=4;break;case 3:e.p=3,e.v,t.status(400).json({error:"Could not get current month preview"});case 4:return e.a(2)}},e,null,[[1,3]])}));return function(r,t){return e.apply(this,arguments)}}()};var L=t().Router();L.route("/api/expenses/current/preview").get(F.requireSignin,K.currentMonthPreview),L.route("/api/expenses").post(F.requireSignin,K.create).get(F.requireSignin,K.listByUser),L.route("/api/expenses/:expenseId").get(F.requireSignin,K.read).put(F.requireSignin,K.update).delete(F.requireSignin,K.remove);const Q=L,V=require("webpack");var X=e.n(V);const Z=require("webpack-dev-middleware");var ee=e.n(Z);const re=require("webpack-hot-middleware");var te=e.n(re);const ne={name:"client",mode:"development",entry:["webpack-hot-middleware/client?reload=true","./client/main.js"],output:{path:o().resolve("./dist"),filename:"bundle.js",publicPath:"/dist/"},module:{rules:[{test:/\.js$/,exclude:/node_modules/,use:["babel-loader"]}]},plugins:[new(X().HotModuleReplacementPlugin),new(X().NoEmitOnErrorsPlugin)],resolve:{extensions:[".js"]},devtool:"eval-source-map"};var oe=process.cwd(),ae=t()();(function(e){if("development"===y.env){var r=X()(ne);e.use(ee()(r,{publicPath:ne.output.publicPath})),e.use(te()(r))}})(ae),ae.use(t().json()),ae.use(t().urlencoded({extended:!0})),ae.use(u()()),ae.use(s()()),ae.use(l()()),ae.use(f()()),ae.use("/",x),ae.use("/",B),ae.use("/",Q),ae.use("/dist",t().static(o().join(oe,"dist"))),v().Promise=global.Promise,v().connect(y.mongoUri,{useNewUrlParser:!0,useUnifiedTopology:!0}),v().connection.on("error",function(){console.error("❌ Unable to connect to database.")}),ae.use(function(e,r){return r.status(404).json({error:"Route not found"})});var ue=y.port;ae.listen(ue,function(e){e?console.error("❌ Server failed to start:",e):console.info("✅ Server started on port ".concat(ue))})})();